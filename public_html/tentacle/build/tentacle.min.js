var Tentacle={};Tentacle.BaseObjectTypes={STRING:"string",BOOLEAN:"boolean",NUMBER:"number"},Tentacle.Exceptions={cantfinddescriptor:"Can't find ClassDescriptor $$ in descriptors",badloggerargs:"Bad logger arguments",verywell:"Everything is fine !"},Tentacle.LoggerLevels={LOG:"log",WARNING:"warning",ERROR:"error"},Tentacle.Logger=new function(){this.sendLog=function(a,b,c){c||(c=Tentacle.LoggerLevels.WARNING);var d="$$";if("array"==typeof b)_.each(b,function(b){var c=a.indexOf(d,1);a=a.slice(0,c-1)+b+a.slice(c+d.length,a.length-1)});else{if("string"!=typeof b)return void console.log(Tentacle.Exceptions.badloggerargs);a=a.replace("$$",b)}switch(c){case Tentacle.LoggerLevels.LOG:console.log(a);break;case Tentacle.LoggerLevels.WARNING:console.warn(a);break;case Tentacle.LoggerLevels.ERROR:console.error(a)}},this.log=function(a,b){Tentacle.Logger.sendLog(a,b,Tentacle.LoggerLevels.LOG)},this.warn=function(a,b){Tentacle.Logger.sendLog(a,b,Tentacle.LoggerLevels.WARNING)},this.error=function(a,b){Tentacle.Logger.sendLog(a,b,Tentacle.LoggerLevels.ERROR)},Tentacle.log=this.log,Tentacle.warn=this.warn,Tentacle.error=this.error},Tentacle.ModelDescriptor=function(a){var b=this,c={};this.load=function(d){_.each(d,function(d,e){var f=new Tentacle.ClassModelDescriptor(e,d,b,a);c[e]=f})},this.getClassDescriptor=function(a){return c[a]?c[a]:(Tentacle.Logger.log(Tentacle.Exceptions.cantfinddescriptor,a),null)}},Tentacle.ClassModelDescriptor=function(a,b,c,d){function e(a,b,c,d){_.each(b,function(b,e){f.flattenAttribute(a,b,e,c,d)})}var f=this;this.getRaw=function(){return b},this.getAttributes=function(){return b.attributes},this.getAttribute=function(a){return getAttributes()[a]},this.getClone=function(){var a=JSON.stringify(b);return JSON.parse(a)},this.getObjectBySource=function(b){var c={};b&&b.uid&&(c.uid=b.uid),b&&b.type&&(c.type=b.type);var d=f.flattenByItem(b);return f.getObject(d,b,c),c.uid||(c.uid=uuid.v4()),c.type||(c.type=a),c},this.getObject=function(a,b,c){_.each(a,function(a,d){if(b&&b.attributes[d])a.type===Tentacle.ModelDecriptorTypes.CONDITIONAL_ATTRIBUTES_SET?(c.attributes[d]=b.attributes[d],f.getObject(a.attributesSets[b.attributes[d]],b,c)):c.attributes[d]=b.attributes[d];else switch(c.attributes||(c.attributes={}),a.type){case Tentacle.BaseObjectTypes.STRING:c.attributes[d]="";break;case Tentacle.BaseObjectTypes.NUMBER:a.defaultvalue?c.attributes[d]=a.defaultvalue:c.attributes[d]=0;break;case Tentacle.BaseObjectTypes.BOOLEAN:a.defaultvalue?c.attributes[d]=a.defaultvalue:c.attributes[d]="false";break;case Tentacle.ModelDecriptorTypes.CONDITIONAL_ATTRIBUTES_SET:c.attributes[d]="";break;case Tentacle.ModelDecriptorTypes.COLLECTION:c.attributes[d]=[];break;default:c.attributes[d]=""}})},this.flattenByItem=function(a){var c={};return f.flattenByDescItem(a,b,c,0),c},this.flattenByDescItem=function(a,b,c,d){e(a,b.attributes,c,d)},this.flattenAttribute=function(a,b,g,h,i){if(b.type!==Tentacle.ModelDecriptorTypes.LINKED_CONDITIONAL_ATTRIBUTES_SET&&b.type!==Tentacle.ModelDecriptorTypes.INCLUDE&&(h[g]=b,h[g].indentation=i),b.type===Tentacle.ModelDecriptorTypes.CONDITIONAL_ATTRIBUTES_SET){if(a&&a.attributes[g]){var j=b.attributesSets[a[g]];e(a,j,h,i+1)}}else if(b.type===Tentacle.ModelDecriptorTypes.INCLUDE){var k=c.getClassDescriptor(b.includetype).getRaw();f.flattenAttribute(a,k,g,h,i)}else if(b.type===Tentacle.ModelDecriptorTypes.LINKED_CONDITIONAL_ATTRIBUTES_SET){if(b.linktype===Tentacle.ModelDecriptorTypes.REFERENCE_ATTRIBUTE_VALUE){var l=a.attributes[b.linkedreference];if(l){var m=d.getItem(l),n=m.attributes[b.linkedattribute],j=b.attributesSets[n];e(a,j,h,i)}}if("attributevaluenonull"===b.linktype&&a[b.link]){var j=b.attribute;e(a,j,h,i)}}}},Tentacle.ModelDecriptorTypes={CONDITIONAL_ATTRIBUTES_SET:"ConditionalAttributesSet",COLLECTION:"collection",LINKED_CONDITIONAL_ATTRIBUTES_SET:"LinkedConditionalAttributesSet",INCLUDE:"include",REFERENCE_ATTRIBUTE_VALUE:"referenceattributevalue"},Tentacle.ModelManager=function(){var a,b={},c={},d=this;this.init=function(b){a=new Tentacle.ModelDescriptor(this),a.load(b),d.loadDefaultModel()},this.loadModel=function(a){localStorage["model-"+a]&&(c=JSON.parse(localStorage["model-"+a]),_.each(c,function(a){b[a.type]||(b[a.type]={}),b[a.type][a.uid]=a}),localStorage.defaultModel=a)},this.getDescriptors=function(){return a.getDescriptors()},this.getClassDescriptor=function(b){return a.getClassDescriptor(b)},this.saveObject=function(a,d){b[a]||(b[a]={}),b[a][d.uid]=d,c[d.uid]=d},this.loadDefaultModel=function(){localStorage.defaultModel?d.loadModel(localStorage.defaultModel):d.loadModel("base")},this.saveDefaultModel=function(){localStorage.defaultModel?d.saveToStorage(localStorage.defaultModel):d.saveToStorage("base")},this.saveToStorage=function(a){a?localStorage["model-"+a]=JSON.stringify(c):localStorage.model=JSON.stringify(c),localStorage.defaultModel=a},this.deleteLocalStorage=function(a){a?delete localStorage["model-"+a]:delete localStorage.model},this.getModel=function(){return b},this.getModelById=function(a){return b[a]},this.deleteItem=function(a,d){delete b[a][d.uid],delete c[d.uid]},this.clearModel=function(){_.each(b,function(a,c){delete b[c]}),c={}},this.getItem=function(a){return c[a]}};
//# sourceMappingURL=tentacle.min.map