var Tentacle={};Tentacle.BaseObjectTypes={STRING:"string",BOOLEAN:"boolean",NUMBER:"number"},Tentacle.Exceptions={cantfinddescriptor:"Can't find ClassDescriptor '$$' in descriptors",badloggerargs:"Bad logger arguments",verywell:"Everything is fine !",cantFindModelProperty:"Can't find property '$$' in model of type '$$'"},Tentacle.filterOperand={AND:"and",OR:"or"},Tentacle.filtersSet=function(a){this.operand=a,this.filters=[],this.addFilter=function(a,b){this.filters.push(new Tentacle.filter(a,b))}},Tentacle.filter=function(a,b){this.propertyName=a,this.propertyValue=b},Tentacle.LoggerLevels={LOG:"log",WARNING:"warning",ERROR:"error"},Tentacle.Logger=new function(){this.sendLog=function(a,b,c){c||(c=Tentacle.LoggerLevels.WARNING);var d="$$";if("object"==typeof b)_.each(b,function(b){var c=a.indexOf(d,1);a=a.slice(0,c)+b+a.slice(c+d.length,a.length)});else{if("string"!=typeof b)return void console.log(Tentacle.Exceptions.badloggerargs);a=a.replace("$$",b)}switch(c){case Tentacle.LoggerLevels.LOG:console.log(a);break;case Tentacle.LoggerLevels.WARNING:console.warn(a);break;case Tentacle.LoggerLevels.ERROR:console.error(a)}},this.log=function(a,b){Tentacle.Logger.sendLog(a,b,Tentacle.LoggerLevels.LOG)},this.warn=function(a,b){Tentacle.Logger.sendLog(a,b,Tentacle.LoggerLevels.WARNING)},this.error=function(a,b){Tentacle.Logger.sendLog(a,b,Tentacle.LoggerLevels.ERROR)},Tentacle.log=this.log,Tentacle.warn=this.warn,Tentacle.error=this.error},Tentacle.Model=function(a){function b(a,c){_.each(a,function(a,e){if(d.attributes[e])a.type===Tentacle.ModelDecriptorTypes.CONDITIONAL_ATTRIBUTES_SET?(c[e]=d.attributes[e],b(a.attributesSets[d.attributes[e]],c)):c[e]=d.attributes[e];else switch(a.type){case Tentacle.BaseObjectTypes.STRING:c[e]="";break;case Tentacle.BaseObjectTypes.NUMBER:a.defaultvalue?c[e]=a.defaultvalue:c[e]=0;break;case Tentacle.BaseObjectTypes.BOOLEAN:a.defaultvalue?c[e]=a.defaultvalue:c[e]="false";break;case Tentacle.ModelDecriptorTypes.CONDITIONAL_ATTRIBUTES_SET:c[e]="";break;case Tentacle.ModelDecriptorTypes.COLLECTION:c[e]=[];break;default:c[e]=""}})}var c,d=this;if(this.attributes={},this.trashCan={},a)for(var e in a)this[e]=a[e];this.init=function(){this.mutate()},this.create=function(a,b){this.type=a,this.uid=uuid.v4(),c=b,this.init()},this.set=function(a,b){this.attributes[a]=b,this.mutate()},this.get=function(a){return this.attributes[a]?this.attributes[a]:(Tentacle.error(Tentacle.Exceptions.cantFindModelProperty,[a,this.type]),null)},this.mutate=function(){var a=c.getClassDescriptor(this.type);_.each(this.attributes,function(a,b){d.trashCan[b]=a});var e={},f=a.flattenByItem(this);b(f,e),this.attributes=e},this.clearTrashCan=function(){this.trashCan={}},this.clone=function(){var a=JSON.stringify(this);return JSON.parse(a)}},Tentacle.ModelDescriptor=function(a){var b=this,c={};this.load=function(d){_.each(d,function(d,e){var f=new Tentacle.ClassModelDescriptor(e,d,b,a);c[e]=f})},this.getClassDescriptor=function(a){return c[a]?c[a]:(Tentacle.Logger.log(Tentacle.Exceptions.cantfinddescriptor,a),null)}},Tentacle.ClassModelDescriptor=function(a,b,c,d){function e(a,b,c,d){_.each(b,function(b,e){f.flattenAttribute(a,b,e,c,d)})}var f=this;this.getRaw=function(){return b},this.getAttributes=function(){return b.attributes},this.getAttribute=function(a){return getAttributes()[a]},this.getClone=function(){var a=JSON.stringify(b);return JSON.parse(a)},this.flattenByItem=function(a){var c={};return f.flattenByDescItem(a,b,c,0),c},this.flattenByDescItem=function(a,b,c,d){e(a,b.attributes,c,d)},this.flattenAttribute=function(a,b,g,h,i){if(b.type!==Tentacle.ModelDecriptorTypes.LINKED_CONDITIONAL_ATTRIBUTES_SET&&b.type!==Tentacle.ModelDecriptorTypes.INCLUDE&&(h[g]=b,h[g].indentation=i),b.type===Tentacle.ModelDecriptorTypes.CONDITIONAL_ATTRIBUTES_SET){if(a&&a.attributes[g]){var j=b.attributesSets[a[g]];e(a,j,h,i+1)}}else if(b.type===Tentacle.ModelDecriptorTypes.INCLUDE){var k=c.getClassDescriptor(b.includetype).getRaw();f.flattenAttribute(a,k,g,h,i)}else if(b.type===Tentacle.ModelDecriptorTypes.LINKED_CONDITIONAL_ATTRIBUTES_SET){if(b.linktype===Tentacle.ModelDecriptorTypes.REFERENCE_ATTRIBUTE_VALUE){var l=a.attributes[b.linkedreference];if(l){var m=d.getItem(l),n=m.attributes[b.linkedattribute],j=b.attributesSets[n];e(a,j,h,i)}}if("attributevaluenonull"===b.linktype&&a[b.link]){var j=b.attribute;e(a,j,h,i)}}}},Tentacle.ModelDecriptorTypes={CONDITIONAL_ATTRIBUTES_SET:"ConditionalAttributesSet",COLLECTION:"collection",LINKED_CONDITIONAL_ATTRIBUTES_SET:"LinkedConditionalAttributesSet",INCLUDE:"include",REFERENCE_ATTRIBUTE_VALUE:"referenceattributevalue"},Tentacle.ModelManager=function(){var a,b={},c={},d=this;this.init=function(b){a=new Tentacle.ModelDescriptor(this),a.load(b),d.loadDefaultModel()},this.loadModel=function(a){localStorage["model-"+a]&&(items=JSON.parse(localStorage["model-"+a]),_.each(items,function(a){c[a.type]||(c[a.type]={}),c[a.type][a.uid]=a}),localStorage.defaultModel=a)},this.getDescriptors=function(){return a.getDescriptors()},this.getClassDescriptor=function(b){return a.getClassDescriptor(b)},this.saveObject=function(a,d){c[a]||(c[a]={}),c[a][d.uid]=d,b[d.uid]=d},this.loadDefaultModel=function(){localStorage.defaultModel?d.loadModel(localStorage.defaultModel):d.loadModel("base")},this.saveDefaultModel=function(){localStorage.defaultModel?d.saveToStorage(localStorage.defaultModel):d.saveToStorage("base")},this.saveToStorage=function(a){a?localStorage["model-"+a]=JSON.stringify(items):localStorage.model=JSON.stringify(items),localStorage.defaultModel=a},this.deleteLocalStorage=function(a){a?delete localStorage["model-"+a]:delete localStorage.model},this.getModel=function(){return c},this.getModelByType=function(a,b){if(b){var d={};for(var e in c[a]){var f=c[a][e];"filter"==typeof b&&f[b.propertyName]&&f[b.propertyName]===b.propertyValue&&(d[e]=f)}return d}return c[a]},this.deleteItem=function(a,d){delete c[a][d.uid],delete b[d.uid]},this.clearModel=function(){_.each(c,function(a,b){delete c[b]}),b={}}};
//# sourceMappingURL=tentacle.min.map